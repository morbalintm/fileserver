<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MORNAS OS Ultimate NAS</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Inter,Segoe UI,sans-serif;}
body{height:100vh;overflow:hidden;background:linear-gradient(135deg,#0f172a,#1e293b,#0f172a);color:#fff;}
#desktop{position:absolute;inset:0;}
#topbar{height:50px;display:flex;justify-content:space-between;align-items:center;padding:0 20px;background:rgba(255,255,255,0.08);backdrop-filter:blur(25px);border-bottom:1px solid rgba(255,255,255,0.1);}
#sidebar{position:absolute;top:50px;bottom:0;left:0;width:220px;padding:15px;backdrop-filter:blur(25px);background:rgba(255,255,255,0.05);border-right:1px solid rgba(255,255,255,0.1);}
.appBtn{padding:12px;margin:10px 0;border-radius:12px;cursor:pointer;background:rgba(255,255,255,0.08);transition:.2s;}
.appBtn:hover{background:rgba(255,255,255,0.15);}
#workspace{position:absolute;top:50px;left:220px;right:0;bottom:0;overflow:hidden;}
.window{position:absolute;width:850px;height:500px;border-radius:18px;backdrop-filter:blur(30px);background:rgba(255,255,255,0.08);box-shadow:0 0 50px rgba(0,0,0,0.5);overflow:hidden;display:flex;flex-direction:column;}
.window-header{height:45px;display:flex;justify-content:space-between;align-items:center;padding:0 15px;background:rgba(255,255,255,0.1);cursor:move;}
.window-controls button{width:22px;height:22px;margin-left:8px;border:none;border-radius:50%;cursor:pointer;}
.close{background:#ef4444}.min{background:#f59e0b}.max{background:#10b981;}
.window-content{flex:1;overflow:auto;display:flex;flex-direction:row;}
#fileTree{width:200px;background:rgba(255,255,255,0.05);padding:10px;border-right:1px solid rgba(255,255,255,0.1);overflow:auto;}
#fileList{flex:1;padding:10px;overflow:auto;}
.file-item{padding:5px;cursor:pointer;border-radius:8px;display:flex;align-items:center;}
.file-item:hover{background:rgba(255,255,255,0.1);}
.file-item.selected{background:rgba(37,99,235,0.4);}
.file-icon{margin-right:8px;}
#previewPanel{width:250px;padding:10px;background:rgba(255,255,255,0.05);border-left:1px solid rgba(255,255,255,0.1);overflow:auto;}
button{margin:0 5px 5px 0;padding:5px;border-radius:6px;background:rgba(255,255,255,0.1);border:none;color:#fff;cursor:pointer;}
button:hover{background:rgba(255,255,255,0.2);}
input[type="file"]{display:none;}
</style>
</head>
<body>
<div id="desktop">
    <div id="topbar"><div>MORNAS OS NAS Ultimate</div></div>
    <div id="sidebar">
        <div class="appBtn" onclick="openApp('fileManager')">ðŸ“‚ File Manager</div>
        <div class="appBtn" onclick="openApp('terminal')">ðŸ’» Terminal</div>
    </div>
    <div id="workspace"></div>
</div>

<script>
/* ============================
   FILESYSTEM INIT
============================ */
let fs = {root:{type:"folder",children:{home:{type:"folder",children:{}}}}};
let path = ["root","home"];
let selectedFiles = new Set();

/* ============================
   WINDOW MANAGER
============================ */
let zIndexCounter=10;
function createWindow(title,content){
    const win=document.createElement("div");
    win.className="window"; win.style.top="80px"; win.style.left="100px"; win.style.zIndex=++zIndexCounter;
    win.innerHTML=`<div class="window-header"><span>${title}</span>
    <div class="window-controls"><button class="min"></button><button class="max"></button><button class="close"></button></div></div>
    <div class="window-content">${content}</div>`;
    workspace.appendChild(win); dragWindow(win); attachControls(win);
}
function dragWindow(win){
    const header=win.querySelector(".window-header"); let isDown=false,ox,oy;
    header.onmousedown=e=>{isDown=true;ox=e.clientX-win.offsetLeft;oy=e.clientY-win.offsetTop;win.style.zIndex=++zIndexCounter;}
    document.onmouseup=()=>isDown=false;
    document.onmousemove=e=>{if(isDown){win.style.left=(e.clientX-ox)+"px";win.style.top=(e.clientY-oy)+"px";}}
}
function attachControls(win){
    win.querySelector(".close").onclick=()=>win.remove();
    win.querySelector(".min").onclick=()=>win.style.display="none";
    win.querySelector(".max").onclick=()=>{win.style.top="0";win.style.left="0";win.style.width="100%";win.style.height="100%";}
}

/* ============================
   APP LAUNCH
============================ */
function openApp(type){
    if(type==="fileManager"){createWindow("File Manager","<div id='fileManagerRoot' style='display:flex;flex:1;'></div>"); buildFileManager();}
    if(type==="terminal"){createWindow("Terminal","<div id='terminalRoot'></div>"); buildTerminal();}
}

/* ============================
   FILE MANAGER
============================ */
function getCurrentDir(){
    let dir = fs; path.forEach(p=>{dir=dir[p].children||dir[p];});
    return dir;
}
function pathString(){return "/"+path.slice(1).join("/");}

function buildFileManager(){
    const root=document.getElementById("fileManagerRoot"); root.innerHTML=""; root.style.display="flex";

    const treeDiv=document.createElement("div"); treeDiv.id="fileTree"; root.appendChild(treeDiv);
    const listDiv=document.createElement("div"); listDiv.id="fileList"; root.appendChild(listDiv);
    const previewDiv=document.createElement("div"); previewDiv.id="previewPanel"; root.appendChild(previewDiv);

    // Toolbar
    const toolbar=document.createElement("div"); toolbar.style.marginBottom="10px"; listDiv.appendChild(toolbar);
    ["New Folder","New File","Upload","Download","Delete","Rename","Search"].forEach(action=>{
        const btn=document.createElement("button"); btn.textContent=action; toolbar.appendChild(btn);
        btn.onclick=()=>fileManagerAction(action);
    });

    buildTree(treeDiv,fs.root,0);
    buildList();
}

function buildTree(container,node,level){
    const div=document.createElement("div"); div.style.marginLeft=(level*12)+"px";
    div.textContent=node.type==="folder"?Object.keys(node.children||{}).length+" items":"";
    container.appendChild(div);
    if(node.children) for(const k in node.children) buildTree(container,node.children[k],level+1);
}

function buildList(){
    const listDiv=document.getElementById("fileList");
    [...listDiv.querySelectorAll(".file-item")].forEach(el=>el.remove());
    const dir=getCurrentDir();
    for(const name in dir){
        const item=document.createElement("div"); item.className="file-item";
        const icon=document.createElement("span"); icon.className="file-icon";
        icon.textContent=dir[name].type==="folder"?"ðŸ“‚":(dir[name].type==="file"&&dir[name].content&&dir[name].content.startsWith("data:image")?"ðŸ–¼ï¸":"ðŸ“„");
        item.appendChild(icon); item.appendChild(document.createTextNode(name));

        if(selectedFiles.has(name)) item.classList.add("selected");
        item.onclick=e=>{
            if(e.ctrlKey) {selectedFiles.has(name)?selectedFiles.delete(name):selectedFiles.add(name);} 
            else {selectedFiles.clear(); selectedFiles.add(name);}
            buildList(); buildPreview();
        };
        item.ondblclick=()=>{if(dir[name].type==="folder"){path.push(name); selectedFiles.clear(); buildFileManager();} else buildPreview();}
        listDiv.appendChild(item);
    }
    buildPreview();
}

function buildPreview(){
    const preview=document.getElementById("previewPanel"); preview.innerHTML="";
    const dir=getCurrentDir();
    selectedFiles.forEach(name=>{
        const file=dir[name]; 
        if(file.type==="file"&&file.content){
            if(file.content.startsWith("data:image")) preview.innerHTML+="<img src='"+file.content+"' style='max-width:100%;margin-bottom:10px;'><br>";
            else preview.innerHTML+="<pre style='white-space:pre-wrap'>"+(file.content.slice(0,200))+"</pre>";
        }
    });
}

function fileManagerAction(action){
    const dir=getCurrentDir();
    if(action==="New Folder"){const n=prompt("Folder name"); if(n) dir[n]={type:"folder",children:{}};}
    if(action==="New File"){const n=prompt("File name"); if(n) dir[n]={type:"file",content:"",size:0};}
    if(action==="Upload"){const inp=document.createElement("input"); inp.type="file"; inp.onchange=e=>{const f=e.target.files[0]; const reader=new FileReader(); reader.onload=r=>{dir[f.name]={type:"file",content:r.target.result,size:f.size}; buildFileManager();}; reader.readAsDataURL(f);}; inp.click();}
    if(action==="Download"){selectedFiles.forEach(name=>{const f=dir[name]; if(f.type==="file"&&f.content){const a=document.createElement("a"); a.href=f.content; a.download=name; a.click();}});}
    if(action==="Delete"){selectedFiles.forEach(name=>{delete dir[name];}); selectedFiles.clear();}
    if(action==="Rename"){selectedFiles.forEach(name=>{const newName=prompt("Rename "+name,name); if(newName) {dir[newName]=dir[name]; delete dir[name];}}); selectedFiles.clear();}
    if(action==="Search"){const term=prompt("Search term"); if(term){alert("Found: "+Object.keys(dir).filter(n=>n.includes(term)).join(", "));}}
    buildList();
}

/* ============================
   TERMINAL
============================ */
function buildTerminal(){
    const container=document.getElementById("terminalRoot"); container.innerHTML="";
    const output=document.createElement("div"); output.style.height="400px"; output.style.overflowY="auto"; output.style.background="black"; output.style.color="#0f0"; output.style.padding="10px"; container.appendChild(output);
    const input=document.createElement("input"); input.style.width="100%"; input.style.background="black"; input.style.color="#0f0"; container.appendChild(input); input.focus();
    input.addEventListener("keydown",e=>{if(e.key==="Enter"){const cmd=input.value.trim(); output.innerHTML+="<div>> "+cmd+"</div>"; executeTerm(cmd,output); input.value=""; output.scrollTop=output.scrollHeight;}});
}

function executeTerm(cmd,out){
    const args=cmd.split(" "); const c=args[0]; const arg=args[1]; const dir=getCurrentDir();
    switch(c){
        case "ls": out.innerHTML+="<div>"+Object.keys(dir).join(" ")+"</div>"; break;
        case "cd": if(arg===".."){if(path.length>2) path.pop();}else if(dir[arg]&&dir[arg].type==="folder") path.push(arg); break;
        case "pwd": out.innerHTML+="<div>"+pathString()+"</div>"; break;
        case "mkdir": if(arg) dir[arg]={type:"folder",children:{}}; break;
        case "touch": if(arg) dir[arg]={type:"file",content:"",size:0}; break;
        case "rm": if(arg) delete dir[arg]; break;
        case "cat": if(arg&&dir[arg]&&dir[arg].type==="file") out.innerHTML+="<pre style='white-space:pre-wrap'>"+dir[arg].content+"</pre>"; break;
        case "clear": out.innerHTML=""; break;
        case "help": out.innerHTML+="<div>Commands: ls, cd, pwd, mkdir, touch, rm, cat, clear, help</div>"; break;
        default: out.innerHTML+="<div>Command not found</div>";
    }
}

/* ============================
   INIT
============================ */
</script>
</body>
</html>
