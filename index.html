<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Web Linux Terminal</title>
<style>
body {
    background:#000;
    color:#0f0;
    font-family:monospace;
    margin:0;
    padding:15px;
}

#terminal {
    white-space:pre-wrap;
}

input {
    background:transparent;
    border:none;
    color:#0f0;
    font-family:monospace;
    outline:none;
    width:80%;
}
</style>
</head>
<body>

<div id="terminal"></div>

<script>
let fileSystem = JSON.parse(localStorage.getItem("vfs")) || {
    home: {
        user: {
            "readme.txt": "Ãœdv a Web Linux Terminalben!"
        }
    }
};

let currentPath = ["home","user"];
let history = [];
let historyIndex = -1;

const terminal = document.getElementById("terminal");

function saveFS(){
    localStorage.setItem("vfs", JSON.stringify(fileSystem));
}

function getCurrentDir(){
    let dir = fileSystem;
    currentPath.forEach(p => dir = dir[p]);
    return dir;
}

function renderPrompt(){
    terminal.innerHTML += `\nuser@web:/${currentPath.join("/")}$ `;
    const input = document.createElement("input");
    terminal.appendChild(input);
    input.focus();

    input.addEventListener("keydown", e=>{
        if(e.key==="Enter"){
            const cmd = input.value;
            history.push(cmd);
            historyIndex = history.length;
            terminal.innerHTML += cmd;
            input.remove();
            execute(cmd);
            renderPrompt();
        }

        if(e.key==="ArrowUp"){
            if(historyIndex>0){
                historyIndex--;
                input.value = history[historyIndex];
            }
        }

        if(e.key==="ArrowDown"){
            if(historyIndex<history.length-1){
                historyIndex++;
                input.value = history[historyIndex];
            }
        }

        if(e.key==="Tab"){
            e.preventDefault();
            autocomplete(input);
        }
    });

    window.scrollTo(0,document.body.scrollHeight);
}

function execute(command){
    const [cmd,...args] = command.split(" ");

    switch(cmd){

        case "ls":
            const dir = getCurrentDir();
            terminal.innerHTML += "\n" + Object.keys(dir).join("  ");
            break;

        case "pwd":
            terminal.innerHTML += "\n/" + currentPath.join("/");
            break;

        case "cd":
            changeDir(args[0]);
            break;

        case "mkdir":
            getCurrentDir()[args[0]] = {};
            saveFS();
            break;

        case "touch":
            getCurrentDir()[args[0]] = "";
            saveFS();
            break;

        case "rm":
            delete getCurrentDir()[args[0]];
            saveFS();
            break;

        case "cat":
            terminal.innerHTML += "\n" + getCurrentDir()[args[0]];
            break;

        case "clear":
            terminal.innerHTML="";
            break;

        case "help":
            terminal.innerHTML += `
            
ls
cd <dir>
pwd
mkdir <name>
touch <name>
rm <name>
cat <file>
clear
help
`;
            break;

        default:
            if(cmd.trim()!=="")
                terminal.innerHTML += "\nCommand not found";
    }
}

function changeDir(target){
    if(target===".."){
        if(currentPath.length>0) currentPath.pop();
        return;
    }

    const dir = getCurrentDir();
    if(dir[target] && typeof dir[target]==="object"){
        currentPath.push(target);
    } else {
        terminal.innerHTML += "\nNo such directory";
    }
}

function autocomplete(input){
    const value = input.value.split(" ");
    if(value.length<2) return;
    const partial = value[1];
    const dir = getCurrentDir();
    const match = Object.keys(dir).find(name=>name.startsWith(partial));
    if(match){
        value[1] = match;
        input.value = value.join(" ");
    }
}

terminal.innerHTML="Web Linux Terminal\nType 'help'\n";
renderPrompt();
</script>

</body>
</html>
