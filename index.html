<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WebOS</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI,sans-serif}

body{
    background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    height:100vh;
    overflow:hidden;
    color:white;
}

/* TERMINAL */

#terminalScreen{
    width:100%;
    height:100%;
    background:black;
    color:#00ff88;
    font-family:monospace;
    padding:20px;
    overflow:auto;
}

input{
    background:transparent;
    border:none;
    color:#00ff88;
    font-family:monospace;
    outline:none;
}

/* DESKTOP */

#desktop{
    display:none;
    width:100%;
    height:100%;
    position:relative;
    backdrop-filter:blur(25px);
}

/* TASKBAR */

#taskbar{
    position:absolute;
    bottom:0;
    width:100%;
    height:50px;
    background:rgba(255,255,255,0.1);
    backdrop-filter:blur(20px);
    display:flex;
    align-items:center;
    padding:0 15px;
}

/* WINDOW */

.window{
    position:absolute;
    width:500px;
    height:350px;
    background:rgba(255,255,255,0.15);
    backdrop-filter:blur(20px);
    border-radius:15px;
    box-shadow:0 0 30px rgba(0,0,0,0.4);
    overflow:hidden;
}

.window-header{
    background:rgba(255,255,255,0.1);
    padding:8px;
    cursor:move;
    font-weight:bold;
}

.window-content{
    padding:10px;
    height:calc(100% - 35px);
    overflow:auto;
}

.icon{
    margin:20px;
    cursor:pointer;
}

textarea{
    width:100%;
    height:100%;
    background:transparent;
    border:none;
    color:white;
    outline:none;
}
</style>
</head>
<body>

<div id="terminalScreen"></div>

<div id="desktop">
    <div class="icon" onclick="openFileManager()">ðŸ“‚ File Manager</div>
    <div class="icon" onclick="openTerminalApp()">ðŸ’» Terminal</div>
    <div id="taskbar">WebOS Desktop</div>
</div>

<script>

/* USER SYSTEM */

let users = JSON.parse(localStorage.getItem("webos_users")) || {};
let currentUser = null;
let fs = null;
let path = ["home"];

const terminal = document.getElementById("terminalScreen");

function saveUsers(){
    localStorage.setItem("webos_users",JSON.stringify(users));
}

/* LOGIN */

function boot(){
    terminal.innerHTML="WebOS v1.0\nlogin: ";
    const input=document.createElement("input");
    terminal.appendChild(input);
    input.focus();

    input.addEventListener("keydown",e=>{
        if(e.key==="Enter"){
            const username=input.value.trim();
            if(!users[username]){
                users[username]={fs:{home:{}},password:null};
                saveUsers();
            }
            currentUser=username;
            fs=users[username].fs;
            terminal.innerHTML+="\nWelcome "+username+"\n";
            prompt();
        }
    });
}

/* TERMINAL */

function prompt(){
    terminal.innerHTML+=`\n${currentUser}@webos:/${path.join("/")}$ `;
    const input=document.createElement("input");
    terminal.appendChild(input);
    input.focus();

    input.addEventListener("keydown",e=>{
        if(e.key==="Enter"){
            const cmd=input.value;
            terminal.innerHTML+=cmd;
            input.remove();
            execute(cmd);
            prompt();
        }
    });

    terminal.scrollTop=terminal.scrollHeight;
}

function getDir(){
    let dir=fs;
    path.forEach(p=>dir=dir[p]);
    return dir;
}

function execute(cmd){
    const [c,...args]=cmd.split(" ");

    if(cmd==="sudo start gui"){
        startGUI();
        return;
    }

    switch(c){
        case "ls":
            terminal.innerHTML+="\n"+Object.keys(getDir()).join(" ");
            break;
        case "mkdir":
            getDir()[args[0]]={};
            saveUsers();
            break;
        case "touch":
            getDir()[args[0]]="";
            saveUsers();
            break;
        case "cd":
            if(args[0]==="..") path.pop();
            else if(getDir()[args[0]]) path.push(args[0]);
            break;
        case "pwd":
            terminal.innerHTML+="\n/"+path.join("/");
            break;
        case "clear":
            terminal.innerHTML="";
            break;
        default:
            terminal.innerHTML+="\nCommand not found";
    }
}

/* GUI */

function startGUI(){
    document.getElementById("terminalScreen").style.display="none";
    document.getElementById("desktop").style.display="block";
}

function createWindow(title,contentHTML){
    const win=document.createElement("div");
    win.className="window";
    win.style.top="100px";
    win.style.left="200px";

    win.innerHTML=`
        <div class="window-header">${title}</div>
        <div class="window-content">${contentHTML}</div>
    `;

    document.getElementById("desktop").appendChild(win);
    drag(win);
}

function drag(el){
    const header=el.querySelector(".window-header");
    let offsetX,offsetY,isDown=false;

    header.onmousedown=e=>{
        isDown=true;
        offsetX=e.clientX-el.offsetLeft;
        offsetY=e.clientY-el.offsetTop;
    };

    document.onmouseup=()=>isDown=false;

    document.onmousemove=e=>{
        if(isDown){
            el.style.left=e.clientX-offsetX+"px";
            el.style.top=e.clientY-offsetY+"px";
        }
    };
}

function openFileManager(){
    let html="<h3>Files</h3>";
    Object.keys(getDir()).forEach(name=>{
        html+=`<div>${name}</div>`;
    });
    createWindow("File Manager",html);
}

function openTerminalApp(){
    createWindow("Terminal","<div>Use main terminal for commands</div>");
}

boot();

</script>

</body>
</html>
